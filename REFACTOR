
Class Refactor Plan (single file, behavior-preserving)
Goal
- Introduce clear classes around RNG, naming, world building, map generation, and UI.
- Keep data tables and string arrays top-level.
- Avoid changing algorithms; only move code into class methods.

Proposed Classes and Responsibilities
1) SeededRng
- Inputs: seed string or u32 base.
- Methods: h32, xs32, n2, randSeed, oneOf, pickWeighted, maybe, shuffleDet.
- Notes: Keep standalone helpers for pure math if needed; class wraps per-seed ops.

2) NameGenerator (existing)
- Keep as-is but move into “Naming + Lexicon” section.
- Owns NPC/faction naming where appropriate.

3) LexiconBuilder
- Methods: buildLineages, buildToponyms, buildRegionsFromToponyms, buildNicknames, buildLexicon.
- Exposes data needed by factionName/namedPOI.

4) WorldBuilder
- Inputs: rng, theme tables, tileset, tiles grid.
- Methods: buildSettlementNames, placeWorldRefs, buildSlice (or buildSlice stays top-level but calls WorldBuilder).
- Owns NPC/faction placement and annotation logic.

5) MapGenerator
- Inputs: rng, biome, tileset, optional worldMeta/climate.
- Methods: genMap and map helper routines (rivers, depths, heights, patches).
- Exposes map html and flags.

6) UIController
- Inputs: document, storage, WorldBuilder/MapGenerator.
- Methods: load/save, renderLists, setCurrentSeed, generate, bindCrossHover, wireEvents.
- Owns DOM queries and event handlers.

Class Refactor Tasks
- Task: Create class skeletons with constructor signatures and stubs. (done)
- Task: Move helper functions into class methods without changing bodies. (done)
- Task: Replace free functions with class method calls. (done)
- Task: Keep top-level string arrays and tables unchanged. (done)
- Task: Keep init flow intact (generate, history, hash, UI events). (done)

End-State Structure (single file)
- Tables (themes, tileset, string pools; all arrays top-level)
- RNG + Utilities (pure helpers, plus SeededRng class)
- Naming + Lexicon (NameGenerator, LexiconBuilder)
- World Placement (WorldBuilder)
- Map Generation (MapGenerator)
- Slice Composition (either WorldBuilder.buildSlice or top-level wrapper)
- State + UI (UIController)
- Events + Init (UIController wiring + init IIFE)
